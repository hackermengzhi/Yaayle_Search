# yaayle新闻搜索系统前端实现
> 2023.6.21

---

## 背景知识
  
众所周知，在互联网时代，Google、百度等搜索引擎（Search Engine）在我们日常的信息需求（Information need）中发挥着不可或缺的作用。
搜索引擎的实现一般可分为以下4个模块：
### 网络爬虫（Web Spider）：主要是从互联网上采集海量网页数据，保存在数据库中，然后构建倒排索引从而为搜索引擎离线检索提供支持。
 
### 索引构建：主要是对网页数据进行清洗、分词、扫描、构建倒排索引（Inverted Index）。一般首先对句子进行分词，分词后的单词或短语称为词条。比如“深圳技术大学在深圳坪山”可以分词为“深圳技术大学/在/深圳/坪山“。其中分隔符中每个单词或短语可以统称为词条。然后扫描整个文档集合，得到每个词条和出现该词条的文档列表，就构成了倒排索引的基本数据结构（类似树的孩子链表表示法，如下图所示）。
  单项索引数据为：
### 词条(word)：出现词条的文档ID1，出现词条的文档ID2,…,出现词条的文档ID3。
 ![image](https://github.com/hackermengzhi/Yaayle_Search/assets/50409074/b83aa62c-d901-4b48-ab11-28f6480e5a18)

### 检索模块：主要根据查询表达式E，检索出候选文档集合C。常用的检索模型为布尔检索模型，比如以上图为例：
  检索word1，则应返回doc1,doc6,doc8。
  检索word1 AND word2 则应返回 doc1。
  检索word3 OR (word1 AND word2) 则应返回 doc1，doc3,doc6,doc9。
  检索 word3 OR word1 AND word2 则应返回doc1。
### 排序模块：使用人工规则或者排序学习（Learning to Rank）方法，综合多种因素（查询、文档匹配得分（比如BM25）、网页Pagerank值、标题匹配得分、时间、地点等因素）对候选文档集合C进行排序，最后将排序结果返回给用户。
  以上过程是搜索引擎的基本框架，请各位同学结合以上背景，完成以下练习。

## 题目设定
	构建搜索系统基本框架实现新闻搜索
  使用250万篇新闻（2014-2016）作为搜索的对象集合，构建新闻搜索引擎。
 搜索引擎基本功能主要包括：
	扫描文件，建立倒排索引（Inverted Index），其结构如上图所示。提示：索引使用链表结构。
（可以首先对文档名进行排序，并设置文档ID）。为了加快找到词条，可改进搜索算法和数据结构，比如二分查找、Hash查找或者B树等查找算法。
	输入单个检索单词，返回按照文档ID大小排序的检索结果，以及原文文档中第一个查询关键词在原文第一次出现的上下文（前后4或8个字）,效果类似百度搜索的时候的摘要：
 ![image](https://github.com/hackermengzhi/Yaayle_Search/assets/50409074/fb9f9d04-704e-48d2-ab26-b9cad5c44e3a)

  比如查询表达式为：苹果，则返回结果可以是：
  1(文档编号)：…每天一个苹果，补充足…
  3(文档编号):….人们都说苹果是一种营….
  ….
	进一步实现多个检索单词时的搜索功能。简单定义，多个检索关键词搜索时必然通过空格隔开，且各个检索关键词之间为OR的关系，检索所有符合搜索关键词的文档并如上文中所述那样返回结果与简单摘要。
上述内容为搜索引擎的基本需求，可以复用之前数据结构课程的相关代码，较之人工智能，更倾向于数据结构的构建与相关算法的实现过程。因此，增加下述人工智能相关的实践内容，为本次课外实践的重要考察内容。

### 非单词检索条件
搜索用户的骚操作之一，即，搜索条件可能不是单词而是一句话。例如，用户希望搜索2014年深圳的新闻，那么他的检索可能并不是“2014 深圳”而有可能是“2014年深圳发生了什么事？”，这种时候搜索引擎就必须能够分析用户提供的作为检索条件的句子，从中找出真正可以用来检索新闻的关键词。
整个处理过程可以简单总结为下面几个步骤：
	分词，即，将检索条件的句子分割成单词。但是，需要注意，如果检索条件的分词结果与倒排索引中可够查询的索引关键词不同的话，会出现无法查询的情况。例如，上述例子中，如果搜索条件中的“深圳”被错误分词成了“深 圳”，那么这次搜索可能难以得到理想的结果。
	停用词过滤，即，将分词结果所得单词中，明显不会用来作为搜索条件的部分过滤掉。例如上文例子中的“了”“什么”之类的单词。需要注意，网络上的停用词库包含停用词过多，可能会过滤掉搜索引擎需要用来检索的一部分词，需要甄别。
	搜索意图重要性的判断。过滤后的数个单词已经可以通过章节2.1（3）中的多单词检索逻辑进行检索了，但是此处还存在一个搜索意图重要性的判断问题，即，需要判断剩下的单词中，哪些单词是搜索用户的本次搜索过程中最希望得到结果反馈的单词。例如，上文的例子中，“2014年”“深圳”“发生”“事”这几个词中，“深圳”可能是最重要的，“2014年”其次。这个重要性的判断将较大影响最终结果的排序，从而影响整个搜索引擎的便利性。
    同时，一次搜索条件中可能会存在既包含单词搜索条件也同时包含句子的搜索条件，需要灵活对应并进行合适的处理。
![image](https://github.com/hackermengzhi/Yaayle_Search/assets/50409074/fe9a5f31-8574-42ac-b484-f365e73193ac)

### 搜索条件扩展
因为搜索用户其实并不确切地知道自己所希望搜索页面的具体内容，所以用户用来搜索的单词可能无法恰巧匹配上文章中的内容。例如，用户搜索“自然语言处理”希望得到相关内容的页面，但最符合用户意图的页面可能通篇都使用的是“NLP”或是“自然语言理解”等词汇，于是用户使用“自然语言处理”进行搜索时将得不到较好的结果。
因此，搜索引擎必须能够自动对用户给出的搜索条件做出符合逻辑的扩展。
可能的扩展方式有如下几种：
	使用意思相近的单词作为搜索条件的扩展。例如，上文例子中的“自然语言处理”和“自然语言理解”等；
	使用具有包含关系的单词作为搜索条件的扩展。例如，上文例子中搜索“自然语言处理”时，是否可以扩展搜索“文本挖掘”之类的词汇；搜索“深圳”新闻的同时，是否可以扩展搜索“坪山”的新闻。
	错字的修正。例如，搜索用户手滑输入了“自燃语言处理”作为搜索条件，是否可以扩展搜索“自然语言处理”。
	等等
符合用户使用逻辑的扩展方式均可以进行尝试和实现。
![4120b9d6ab6e606d3998512976002b7](https://github.com/hackermengzhi/Yaayle_Search/assets/50409074/648e0e06-ef7c-46b3-932c-e9fdeafad0c1)
![0640715141ebbce99c5cbd5fb012166](https://github.com/hackermengzhi/Yaayle_Search/assets/50409074/18c4c431-b219-4910-8777-528da07ef5aa)

## 搜索结果的排序
搜索用户大部分时候都只会关注返回的搜索结果中最上面的几个或十几个，因此，通过合理有效的排序将用户所希望页面排序在前面，将会较大的影响搜索引擎的使用便利性。
首先，简单整理一下通过上述所有功能搜索引擎搜索得到的结果的方式：
	用户提供的单个单词搜索条件直接搜索得到的结果；
	用户提供的多个单词搜索条件，根据OR逻辑组合后，直接搜索得到的各种结果；
	用户提供的句子搜索条件，通过分词/过滤/意图识别后，得到多个单词作为搜索条件，搜索得到的各种结果；
	用户提供的单词/句子搜索条件，经过相似/包含/纠错等扩展之后，得到多个其他单词作为搜索条件，搜索得到各种结果。
搜索引擎排序的对象便是上述过程中得到的所有结果。其中，可能会影响排序结果的几个因素：
	多个单词作为搜索条件时，匹配了所有单词的结果应该要优于只匹配部分单词的搜索结果；
	多个单词作为搜索条件时，如果认为重要性按照从左向右递减，则可以认为匹配了排列靠左部分单词的搜索结果应该要优于匹配了靠右部分单词的结果；
	句子作为搜索条件时，影响排序结果的因素与多个单词作为搜索条件时基本相同，但是单词重要性并非按照从左到右而是通过重要性判断来决定；
	使用扩展单词作为搜索条件时，影响排序结果的因素与多个单词作为搜索条件时相同，重要性方面原搜索单词要高于扩展单词；
	在所有搜索结果中，可以认为能够有效概括其他结果的结果优先级要较高，例如通过bm25的textrank来进行计算等；
	其他的诸如网页Pagerank值、标题匹配得分、时间、地点等因素等等，均可以用来计算排序。
总而言之，使用人工规则或者排序学习（Learning to Rank）方法，综合多种因素（查询、文档匹配得分（比如BM25）、网页Pagerank值、标题匹配得分、时间、地点等因素）给候选文档集合中的文档进行打分，并根据分值进行排序，最后将排序结果返回给用户。
![8882805c7e1b0e510fc650458b07f87](https://github.com/hackermengzhi/Yaayle_Search/assets/50409074/f93241c0-b9e0-44b8-8b42-7e5bea066458)
